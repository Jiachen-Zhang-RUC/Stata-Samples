 use "D:\STATApractice\catholic.dta"
 **1
 sum id
/*
    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
          id |      7,430     4589838     2744467     124902    7979086
*/
 count if cathhs==1
 ** 452
 reg math12 cathhs lfaminc motheduc fatheduc
/*
      Source |       SS           df       MS      Number of obs   =     7,430
-------------+----------------------------------   F(4, 7425)      =    420.16
       Model |  122685.417         4  30671.3543   Prob > F        =    0.0000
    Residual |  542023.626     7,425   72.999815   R-squared       =    0.1846
-------------+----------------------------------   Adj R-squared   =    0.1841
       Total |  664709.043     7,429  89.4749015   Root MSE        =     8.544

------------------------------------------------------------------------------
      math12 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
      cathhs |    1.47723   .4179415     3.53   0.000      .657946    2.296514
     lfaminc |   1.848669    .142631    12.96   0.000     1.569071    2.128266
    motheduc |   .7163451   .0620806    11.54   0.000     .5946496    .8380407
    fatheduc |   .8912532   .0561526    15.87   0.000     .7811782    1.001328
       _cons |   11.14863   1.310977     8.50   0.000      8.57874    13.71851
------------------------------------------------------------------------------
*/
**3
 reg cathhs lfaminc motheduc fatheduc parcath if math12!=.
/*
      Source |       SS           df       MS      Number of obs   =     7,430
-------------+----------------------------------   F(4, 7425)      =    196.99
       Model |  40.7276208         4  10.1819052   Prob > F        =    0.0000
    Residual |  383.775206     7,425  .051686896   R-squared       =    0.0959
-------------+----------------------------------   Adj R-squared   =    0.0955
       Total |  424.502826     7,429  .057141315   Root MSE        =    .22735

------------------------------------------------------------------------------
      cathhs |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     lfaminc |   .0183513   .0037927     4.84   0.000     .0109166    .0257861
    motheduc |   .0039228   .0016554     2.37   0.018     .0006778    .0071678
    fatheduc |   .0065846   .0014927     4.41   0.000     .0036585    .0095107
     parcath |   .1430575   .0055661    25.70   0.000     .1321463    .1539687
       _cons |  -.3210813   .0347551    -9.24   0.000    -.3892111   -.2529515
------------------------------------------------------------------------------
*/

test parcath
/*
 ( 1)  parcath = 0

       F(  1,  7425) =  660.56
            Prob > F =    0.0000
*/

ivregress 2sls  math12 lfaminc motheduc fatheduc (cathhs = parcath)  

estat endogenous

**6
 gen mc= cathhs*motheduc

 gen mp= parcath* motheduc

 reg mc lfaminc motheduc fatheduc mp if math12!=.
 test mp
 
 **/7
  mean motheduc
/*
Mean estimation                   Number of obs   =      7,430

--------------------------------------------------------------
             |       Mean   Std. Err.     [95% Conf. Interval]
-------------+------------------------------------------------
    motheduc |   13.35686   .0232719      13.31124    13.40248
--------------------------------------------------------------
*/

 gen mc1= cathhs*(motheduc- 13.35686)

 gen mp1= parcath* (motheduc- 13.35686)

 reg mc1 lfaminc motheduc fatheduc mp1 if math12!=.
/*
      Source |       SS           df       MS      Number of obs   =     7,430
-------------+----------------------------------   F(4, 7425)      =    242.16
       Model |  185.846538         4  46.4616346   Prob > F        =    0.0000
    Residual |  1424.59562     7,425   .19186473   R-squared       =    0.1154
-------------+----------------------------------   Adj R-squared   =    0.1149
       Total |  1610.44216     7,429  .216777784   Root MSE        =    .43802

------------------------------------------------------------------------------
         mc1 |      Coef.   Std. Err.      t    P>|t|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
     lfaminc |   .0074949   .0072939     1.03   0.304    -.0068033     .021793
    motheduc |   .0095084   .0037526     2.53   0.011     .0021523    .0168646
    fatheduc |  -.0025839    .002876    -0.90   0.369    -.0082216    .0030538
         mp1 |   .1178922   .0052206    22.58   0.000     .1076584     .128126
       _cons |  -.1256563   .0720616    -1.74   0.081    -.2669175    .0156049
------------------------------------------------------------------------------
*/
test mp1
/*
 ( 1)  mp1 = 0

       F(  1,  7425) =  509.96
            Prob > F =    0.0000
*/
ivregress 2sls  math12 lfaminc motheduc fatheduc (mc1 = mp1)
/*
Instrumental variables (2SLS) regression          Number of obs   =      7,430
                                                  Wald chi2(4)    =    1624.83
                                                  Prob > chi2     =     0.0000
                                                  R-squared       =     0.1541
                                                  Root MSE        =     8.6991

------------------------------------------------------------------------------
      math12 |      Coef.   Std. Err.      z    P>|z|     [95% Conf. Interval]
-------------+----------------------------------------------------------------
         mc1 |  -3.479449   .8794491    -3.96   0.000    -5.203137    -1.75576
     lfaminc |   1.906031   .1449536    13.15   0.000     1.621927    2.190135
    motheduc |   .9073539   .0792746    11.45   0.000     .7519785    1.062729
    fatheduc |   .8940437   .0571342    15.65   0.000     .7820626    1.006025
       _cons |   8.182638   1.475697     5.54   0.000     5.290324    11.07495
------------------------------------------------------------------------------
Instrumented:  mc1
Instruments:   lfaminc motheduc fatheduc mp1
*/
estat endogenous
/*
  Tests of endogeneity
  Ho: variables are exogenous

  Durbin (score) chi2(1)          =  18.1742  (p = 0.0000)
  Wu-Hausman F(1,7424)            =   18.204  (p = 0.0000)
*/

